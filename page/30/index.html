<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"edward.org.cn","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="点点滴滴">
<meta property="og:url" content="http://edward.org.cn/page/30/index.html">
<meta property="og:site_name" content="点点滴滴">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Edward">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://edward.org.cn/page/30/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>点点滴滴</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a92ed22eafce466e7a7b17546bb0dc6f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">点点滴滴</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://edward.org.cn/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/PHP%20WEB%20%20API%20framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Edward">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="点点滴滴">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/PHP%20WEB%20%20API%20framework/" class="post-title-link" itemprop="url">PHP WEB  API framework</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-31 14:48:01" itemprop="dateCreated datePublished" datetime="2020-12-31T14:48:01+08:00">2020-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-16 12:37:33" itemprop="dateModified" datetime="2020-01-16T12:37:33+08:00">2020-01-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%83%82%E7%AC%94%E5%A4%B4/" itemprop="url" rel="index"><span itemprop="name">烂笔头</span></a>
                </span>
            </span>

          
            <span id="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/PHP%20WEB%20%20API%20framework/" class="post-meta-item leancloud_visitors" data-flag-title="PHP WEB  API framework" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="http://www.phalapi.net/">http://www.phalapi.net/</a> </p>
<p><a target="_blank" rel="noopener" href="http://www.slimframework.com/">http://www.slimframework.com/</a> </p>
<p><a target="_blank" rel="noopener" href="http://dev.enchant.com/api/v1">http://dev.enchant.com/api/v1</a> </p>
<p><a target="_blank" rel="noopener" href="http://symfony.com/">http://symfony.com/</a> </p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/xukai871105/article/details/18775957">http://blog.csdn.net/xukai871105/article/details/18775957</a> </p>
<p><a target="_blank" rel="noopener" href="http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api">http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api</a> </p>
<p><a target="_blank" rel="noopener" href="http://initphp.com/">http://initphp.com/</a> </p>
<p><a target="_blank" rel="noopener" href="http://www.waveframework.com/">http://www.waveframework.com/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://edward.org.cn/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/PhoneWindowManger/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Edward">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="点点滴滴">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/PhoneWindowManger/" class="post-title-link" itemprop="url">PhoneWindowManger</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-31 14:48:01" itemprop="dateCreated datePublished" datetime="2020-12-31T14:48:01+08:00">2020-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-16 12:37:32" itemprop="dateModified" datetime="2020-01-16T12:37:32+08:00">2020-01-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%83%82%E7%AC%94%E5%A4%B4/" itemprop="url" rel="index"><span itemprop="name">烂笔头</span></a>
                </span>
            </span>

          
            <span id="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/PhoneWindowManger/" class="post-meta-item leancloud_visitors" data-flag-title="PhoneWindowManger" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在按键上报前做了些动作。。。做 了一半没做好。。。</p>
<p>if (keyCode == KeyEvent.KEYCODE_VOLUME_DOWN){</p>
<p>if (repeatCount == 0) {</p>
<p>startDockOrHome();</p>
<p>                    return -1;</p>
<p>                } else if ((event.getFlags() &amp; KeyEvent.FLAG_LONG_PRESS) != 0) {</p>
<p>                    if (!keyguardOn) {</p>
<p>                        return 0;</p>
<p>                    }</p>
<p>                }</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/PhoneWindowManger/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://edward.org.cn/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/phone%20%E6%A8%A1%E5%BC%8F%20%E9%BB%98%E8%AE%A4%20USB%20%E9%94%AE%E7%9B%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Edward">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="点点滴滴">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/phone%20%E6%A8%A1%E5%BC%8F%20%E9%BB%98%E8%AE%A4%20USB%20%E9%94%AE%E7%9B%98/" class="post-title-link" itemprop="url">phone 模式 默认 USB 键盘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-31 14:48:01" itemprop="dateCreated datePublished" datetime="2020-12-31T14:48:01+08:00">2020-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-16 12:37:33" itemprop="dateModified" datetime="2020-01-16T12:37:33+08:00">2020-01-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%83%82%E7%AC%94%E5%A4%B4/" itemprop="url" rel="index"><span itemprop="name">烂笔头</span></a>
                </span>
            </span>

          
            <span id="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/phone%20%E6%A8%A1%E5%BC%8F%20%E9%BB%98%E8%AE%A4%20USB%20%E9%94%AE%E7%9B%98/" class="post-meta-item leancloud_visitors" data-flag-title="phone 模式 默认 USB 键盘" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>— a/frameworks/base/services/java/com/android/server/input/InputManagerService.java</p>
<p>+++ b/frameworks/base/services/java/com/android/server/input/InputManagerService.java</p>
<p>@@ -89,7 +89,8 @@ import java.util.HashSet;</p>
<p> import libcore.io.Streams;</p>
<p> import libcore.util.Objects;</p>
<p>-</p>
<p>+import android.os.SystemProperties;</p>
<p>+import android.content.res.Configuration;</p>
<p> /*</p>
<p>  * Wraps the C++ InputManager and provides its callbacks.</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/phone%20%E6%A8%A1%E5%BC%8F%20%E9%BB%98%E8%AE%A4%20USB%20%E9%94%AE%E7%9B%98/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://edward.org.cn/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/persist%20%E5%B1%9E%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Edward">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="点点滴滴">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/persist%20%E5%B1%9E%E6%80%A7/" class="post-title-link" itemprop="url">persist 属性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-31 14:48:01" itemprop="dateCreated datePublished" datetime="2020-12-31T14:48:01+08:00">2020-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-16 12:37:32" itemprop="dateModified" datetime="2020-01-16T12:37:32+08:00">2020-01-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%83%82%E7%AC%94%E5%A4%B4/" itemprop="url" rel="index"><span itemprop="name">烂笔头</span></a>
                </span>
            </span>

          
            <span id="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/persist%20%E5%B1%9E%E6%80%A7/" class="post-meta-item leancloud_visitors" data-flag-title="persist 属性" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>/data/property  目录下面保存persist值。可作公有标志。</p>
<p>SystemProperties.set(&quot;persist.sys.preinstalled&quot;, &quot;1&quot;);</p>
<p>import android.os.SystemProperties;</p>
<p>SystemProperties.set(&quot;persist.sys.country&quot;,”china”);</p>
<p>String vmHeapSize = SystemProperties.get(&quot;dalvik.vm.heapgrowthlimit&quot;, &quot;24m&quot;);</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://edward.org.cn/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/pck_type%20%E6%89%93%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Edward">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="点点滴滴">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/pck_type%20%E6%89%93%E5%8C%85/" class="post-title-link" itemprop="url">pck_type 打包</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-31 14:48:01" itemprop="dateCreated datePublished" datetime="2020-12-31T14:48:01+08:00">2020-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-16 12:37:33" itemprop="dateModified" datetime="2020-01-16T12:37:33+08:00">2020-01-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%83%82%E7%AC%94%E5%A4%B4/" itemprop="url" rel="index"><span itemprop="name">烂笔头</span></a>
                </span>
            </span>

          
            <span id="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/pck_type%20%E6%89%93%E5%8C%85/" class="post-meta-item leancloud_visitors" data-flag-title="pck_type 打包" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>/*<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<ul>
<li>FILENAME  :   </li>
<li>AUTHOR    :   <a href="mailto:&#x66;&#101;&#x6e;&#103;&#x6a;&#x6c;&#48;&#50;&#54;&#64;&#x31;&#50;&#x36;&#x2e;&#x63;&#111;&#109;">&#x66;&#101;&#x6e;&#103;&#x6a;&#x6c;&#48;&#50;&#54;&#64;&#x31;&#50;&#x36;&#x2e;&#x63;&#111;&#109;</a></li>
<li>DATA      :   2007-1-3</li>
<li>MODIFY    :   </li>
<li>HISTORY   :   </li>
<li>DESC      :   pck_type 打包</li>
<li>COPYRIGHT :   深圳永辉昌 2007</li>
<li><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>/<br>#include &quot;config.h&quot;<br>#include &quot;ezxml.h&quot;<br>#include &quot;readDB.h&quot;<br>#include &quot;pck_type.h&quot;<br>#include &quot;command.h&quot;<br>#ifdef __cplusplus<br>extern &quot;C&quot; {<br>#endif<br>extern HANDLE                             g_carportHandle ;     //诊断串口句柄<br>extern DEFAULT_MSGATTR                      g_defaultMsgAttr;     //MSG项的缺省参数<br>int unpack_mbuf(int type, U8 *buf, int bufsize)<br>{<br>//分裂<br>int pos = 0;<br>//int times = 0;<br>U8 rbuf[256];<br>int len = 0;<br>int num;<br>while(pos + buf[3+pos] +5 &lt;= bufsize)<br>  {<pre><code> num = unpack_buf(type, buf+pos, buf[pos+3]+5);</code></pre>
memcpy(rbuf+len, buf+pos,num);<br>len += num;<br>pos += buf[3+pos] + 5;<br>}<br>  memcpy(buf, rbuf, len);<br>return len;<br>}<br>int unpack_buf(int type,U8 <em>buf, int bufsize)<br>{<br>if((buf[4]&amp;0xf0) == 0xf0)<br>  {<br>return 0;<br>}<br>switch(type)<br>  {<br>case 0: return unpack_buf0(buf,bufsize);<br>case 1: return unpack_buf1(buf,bufsize);<br>case 2: return unpack_buf2(buf,bufsize);<br>case 3: return unpack_buf3(buf,bufsize);<br>case 4: return unpack_buf4(buf,bufsize);<br>case 5: return unpack_buf5(buf,bufsize);<br>case 6: return unpack_buf6(buf,bufsize);//解包方式同方式零,但校验位CRC校验<br>case 7: return unpack_buf7(buf,bufsize);//解包方式同方式零,但校验位为一字节和<br>case 8: return unpack_buf8(buf,bufsize);<br>case 9: return unpack_buf9(buf,bufsize);<br>case 0x0a: return unpack_bufa(buf,bufsize);<br>case 0x0b: return unpack_bufb(buf,bufsize);<br>case 0x0c: return unpack_bufc(buf,bufsize);<br>case 0x0d: return unpack_bufd(buf,bufsize);<br>case 0x0e: return unpack_bufe(buf,bufsize);<br>case 0x0f: return unpack_buff(buf,bufsize);<br>case 0x13: return unpack_buf13(buf,bufsize);<br>case 0x14: return unpack_buf14(buf,bufsize);<br>}<br>return 0;<br>}<br>/</em><br>FMT:格式头<br>TGT:发送ID<br>SRC:接收ID<br>LEN:命令数据长度<br>SID:命令头，一般是SID+DATA表示一条完整的命令<br>DATA:命令内容<br>CS:一字节校验和<br>0x00:直接打包，无校验<br>0x01:KWP2000格式1 Fmt    + Sid + Data + CS        (0x80+len)<br>0x02:KWP2000格式2 Fmt + Tgt + Src + Sid + Data + CS     (0x80+len)<br>0x03:KWP2000格式3 Fmt + Len + Sid + Data + CS          (80)<br>0x04:KWP2000格式4 Fmt + Tgt + Src + Len + Sid + Data + CS    (80)<br>0x05:KWP2000格式5 Fmt + Tgt + Src + Sid + Data + CS       (68) Tgt:0x6A<br>0X06:主要是通用VPW协议，打包方式同方式零,但校验位CRC校验<br>0X07:KWP2000格式，打包方式同方式零,校验位是一字节和<br>0x08:马自达老协议打包方式 FMT + TGT + SRC + SID + DATA + CS (0x04+LEN*0x10)<br>0x09:OBDII,TGT=6A,校验位CRC校验<br>0x0a:福特，加C4的头,校验位CRC校验<br>0x0b:OBDII,68,6a,f1,其它同打包方式9<br>0x0c:打包方式同方式零,加长度和一字节校验和 LEN + SID + DATA + CS<br>0x0d:打包方式同方式2, FMT + TGT + SRC + SID + DATA + CS (0xc0+len)<br>0x0e:打包方式同方式零,第三位是数据长度，最后两位是前面全部字节的和，低字节在前,高字节在后(主要用于奔驰协议)<br>0x0f:打包方式同方式0，第二位是长度，校验位为一字节和取补<br>0x13:打包方式同方式0，最后一位是异或校验<br>0x14:打包方式同方式0，倒数第二位是异或校验,最后一位是一字节和取反</li>
<li>/<br>int pack_type(ezxml_t xml, U8 *u8buf ,int bufsize)<br>{<br>switch(getPackType(xml))<br>  {<br>case 0: return pack_type0(xml,u8buf, bufsize);<br>case 1: return pack_type1(xml,u8buf, bufsize);<br>case 2: return pack_type2(xml,u8buf, bufsize);<br>case 3: return pack_type3(xml,u8buf, bufsize);<br>case 4: return pack_type4(xml,u8buf, bufsize);<br>case 5: return pack_type5(xml,u8buf, bufsize);<br>case 6: return pack_type6(xml,u8buf, bufsize);<br>case 7: return pack_type7(xml,u8buf, bufsize);<br>case 8: return pack_type8(xml,u8buf, bufsize);<br>case 9: return pack_type9(xml,u8buf, bufsize);<br>case 0x0a: return pack_typea(xml,u8buf, bufsize);<br>case 0x0b: return pack_typeb(xml,u8buf, bufsize);<br>case 0x0c: return pack_typec(xml,u8buf, bufsize);<br>case 0x0d: return pack_typed(xml,u8buf, bufsize);<br>case 0x0e: return pack_typee(xml,u8buf, bufsize);<br>case 0x0f: return pack_typef(xml,u8buf, bufsize);<br>case 0x13: return pack_type13(xml,u8buf, bufsize);<br>case 0x14: return pack_type14(xml,u8buf, bufsize);<br>}<br>return 0;<br>}<br>int getPackType(ezxml_t msgxml)<br>{<br>char *pck_type = (char *)ezxml_attr(msgxml, &quot;PCK_TYPE&quot;);<br>if(pck_type)<br>return getHex(pck_type);      <br>return g_defaultMsgAttr.m_PCK_TYPE;<br>}<br>int unpack_bufb(U8 *buf, int bufsize)<br>{<br>int m=0;<br>int i,j,k;<br>int l=285;int n;<br>//int number=0;<br>if(bufsize &lt; 9)<br>return 0;<br>for(i=5; i&lt;bufsize; i++)<br>  {<pre><code> buf[m++] = buf[i];</code></pre>
}<br>  m=bufsize-5;<br>buf[m-1] = buf[m-2];<br>buf[m-2] = 0;<br>if(m==9||m==8||m==13||m==7||m==11||m==10||m==6||m==12)<br>  {  <pre><code> buf[m-2]=0x0a;</code></pre>
if(m==8)<pre><code>    buf[m-2]=0xf6;</code></pre>
if(m==13)<pre><code>    buf[m-2]=0xe2;</code></pre>
if(m==7)<pre><code>    buf[m-2]=0x10;</code></pre>
if(m==11)<pre><code>    buf[m-2]=0x7c;</code></pre>
if(m==10)<pre><code>    buf[m-2]=0xe9;</code></pre>
if(m==12)<pre><code>    buf[m-2]=0xfe;</code></pre>
if(m==6)<pre><code>    buf[m-2]=0x59;</code></pre>
j=buf[0];<br>for(i=1;i&lt;m-1;i++)<pre><code> &#123;</code></pre>
//MessageBox(&quot;ok&quot;);<br>for(k=0;k&lt;8;k++)<pre><code>    &#123;
       j=j&amp;lt;&amp;lt;1;</code></pre>
n=(buf[i]&gt;&gt;(7-k))&amp;0x01;<br>j+=n;<br>if(j&gt;255)<pre><code>          j=j^l;</code></pre>
}<pre><code> &#125;
 buf[m-2]=j;</code></pre>
}<br>if(buf[m-1]!=buf[m-2])<br>return 0;<br>else<br>     return m-2;<br>}<br>int unpack_bufa(U8 *buf, int bufsize)<br>{<br>int m=0;<br>int i,j,k;<br>int l=285;int n;<br>//int number=0;<br>if(bufsize &lt; 9)<br>return 0;<br>for(i=5; i&lt;bufsize; i++)<br>  {<pre><code> buf[m++] = buf[i];</code></pre>
}<br>  m=bufsize-5;<br>buf[m-1] = buf[m-2];<br>buf[m-2] = 0;<br>if(m==9||m==8||m==13||m==7||m==11||m==10||m==6||m==12)<br>  {  <pre><code> buf[m-2]=0x0a;</code></pre>
if(m==8)<pre><code>    buf[m-2]=0xf6;</code></pre>
if(m==13)<pre><code>    buf[m-2]=0xe2;</code></pre>
if(m==7)<pre><code>    buf[m-2]=0x10;</code></pre>
if(m==11)<pre><code>    buf[m-2]=0x7c;</code></pre>
if(m==10)<pre><code>    buf[m-2]=0xe9;</code></pre>
if(m==12)<pre><code>    buf[m-2]=0xfe;</code></pre>
if(m==6)<pre><code>    buf[m-2]=0x59;</code></pre>
j=buf[0];<br>for(i=1;i&lt;m-1;i++)<pre><code> &#123;</code></pre>
//MessageBox(&quot;ok&quot;);<br>for(k=0;k&lt;8;k++)<pre><code>    &#123;
       j=j&amp;lt;&amp;lt;1;</code></pre>
n=(buf[i]&gt;&gt;(7-k))&amp;0x01;<br>j+=n;<br>if(j&gt;255)<pre><code>          j=j^l;</code></pre>
}<pre><code> &#125;
 buf[m-2]=j;</code></pre>
}<br>if(buf[m-1]!=buf[m-2])<br>return 0;<br>else<br>     return m-2;<br>}<br>int unpack_buf9(U8 *buf, int bufsize)<br>{<br>int m=0;<br>int i,j,k;<br>int l=285;int n;<br>//int number=0;<br>if(bufsize &lt; 9)<br>return 0;<br>for(i=5; i&lt;bufsize; i++)<br>  {<pre><code> buf[m++] = buf[i];</code></pre>
}<br>  m=bufsize-5;<br>buf[m-1] = buf[m-2];<br>buf[m-2] = 0;<br>if(m==9||m==8||m==13||m==7||m==11||m==10||m==6||m==12)<br>  {  <pre><code> buf[m-2]=0x0a;</code></pre>
if(m==8)<pre><code>    buf[m-2]=0xf6;</code></pre>
if(m==13)<pre><code>    buf[m-2]=0xe2;</code></pre>
if(m==7)<pre><code>    buf[m-2]=0x10;</code></pre>
if(m==11)<pre><code>    buf[m-2]=0x7c;</code></pre>
if(m==10)<pre><code>    buf[m-2]=0xe9;</code></pre>
if(m==12)<pre><code>    buf[m-2]=0xfe;</code></pre>
if(m==6)<pre><code>    buf[m-2]=0x59;</code></pre>
j=buf[0];<br>for(i=1;i&lt;m-1;i++)<pre><code> &#123;</code></pre>
//MessageBox(&quot;ok&quot;);<br>for(k=0;k&lt;8;k++)<pre><code>    &#123;
       j=j&amp;lt;&amp;lt;1;</code></pre>
n=(buf[i]&gt;&gt;(7-k))&amp;0x01;<br>j+=n;<br>if(j&gt;255)<pre><code>          j=j^l;</code></pre>
}<pre><code> &#125;
 buf[m-2]=j;</code></pre>
}<br>if(buf[m-1]!=buf[m-2])<br>return 0;<br>else<br>     return m-2;<br>}<br>int unpack_buf8(U8 *buf, int bufsize)<br>{<br>int m=0;<br>int i,j;<br>int n = 0;<br>U8 u8buf[128];<br>int number = 0 ;<br>if(bufsize &lt; 9)<br>return 0;<br>for(i=5; i&lt;bufsize; i++)<br>  {<pre><code> buf[m++] = buf[i];</code></pre>
}<br>  m=bufsize-5;<br>if(m &gt; (buf[0]/16+2))<br>  {<pre><code> number = m;</code></pre>
for(j = 0; number &gt;1; )<pre><code> &#123;
    memcpy(u8buf, buf+j, number);</code></pre>
n = u8buf[0]/16+1;<br>u8buf[n] = 0;<br>for(i = 0; i&lt;n-1; i++)<pre><code>    &#123;
       u8buf[n] += u8buf[i];</code></pre>
}<br>if(u8buf[n]!=u8buf[n-1])<br>return 0;<br>number = number-n;<br>j = j+n;<br>}<br>return m-1;<br>}<br>else<br>{<pre><code> buf[m] = 0;</code></pre>
for(i = 0; i&lt;m-2; i++)<pre><code> &#123;
    buf[m] += buf[i];</code></pre>
}<br>if(buf[m]!=buf[m-2])<br>return 0;<br>}<br>return m-2;<br>}<br>int unpack_buf7(U8 *buf, int bufsize)<br>{<br>int number=0;<br>int i;<br>U8 cs=0;<br>if(bufsize &lt; 5)<br>return 0;<br>for(i=5; i&lt;bufsize; i++)<br>  {<pre><code> buf[number++] = buf[i];</code></pre>
}<br>  number–;<br>for(i=0;i&lt;number-1;i++)<pre><code> cs+=buf[i];</code></pre>
if(cs!=buf[number-1])<br>return 0;<br>return number;<br>}<br>int unpack_buf6(U8 *buf, int bufsize)<br>{<br>int m=0;<br>int i,j,k;<br>int l=285;int n;<br>if(bufsize &lt; 5)<br>return 0;<br>for(i=5; i&lt;bufsize; i++)<br>  {<pre><code> buf[m++] = buf[i];</code></pre>
}<br>  m=bufsize-5;<br>buf[m-1]=buf[m-2];<br>if(m==9||m==8||m==13||m==7||m==11||m==10||m==6||m==12)<br>  {  <pre><code> buf[m-2]=0x0a;</code></pre>
if(m==8)<pre><code>    buf[m-2]=0xf6;</code></pre>
if(m==13)<pre><code>    buf[m-2]=0xe2;</code></pre>
if(m==7)<pre><code>    buf[m-2]=0x10;</code></pre>
if(m==11)<pre><code>    buf[m-2]=0x7c;</code></pre>
if(m==10)<pre><code>    buf[m-2]=0xe9;</code></pre>
if(m==12)<pre><code>    buf[m-2]=0xfe;</code></pre>
if(m==6)<pre><code>    buf[m-2]=0x59;</code></pre>
j=buf[0];<br>for(i=1;i&lt;m-1;i++)<pre><code> &#123;</code></pre>
//MessageBox(&quot;ok&quot;);<br>for(k=0;k&lt;8;k++)<pre><code>    &#123;
       j=j&amp;lt;&amp;lt;1;</code></pre>
n=(buf[i]&gt;&gt;(7-k))&amp;0x01;<br>j+=n;<br>if(j&gt;255)<pre><code>          j=j^l;</code></pre>
}<pre><code> &#125;
 buf[m-2]=j;</code></pre>
}<br>if(buf[m-2]!=buf[m-1])<br>return 0;<br>else<br>     return m-1;<br>}<br>int unpack_buf5(U8 *buf, int bufsize)<br>{<br>int number = 0;<br>int i;<br>if(bufsize &lt; 9)<br>return 0;<br>if(buf[5] != 0x48)<br>return 0;<br>for(i=8; i&lt;bufsize; i++)<br>  {<pre><code> buf[number++] = buf[i];</code></pre>
}<br>return number-1;<br>}<br>int unpack_buf4(U8 *buf, int bufsize)<br>{<br>int number=0;<br>int i;<br>U8 len;<br>//U8 hex = 0;<br>if(bufsize &lt; 8)<br>return 0;<br>//长度校验<br>len = buf[5]&amp;0x3f;<br>if(len==0)<br>  {<pre><code> len=buf[8];</code></pre>
number=9;<br>}<br>else<br>number=8;<br>if(bufsize &lt; number+ len+1)<br>return 0;<br>//校验和校验<br>  //for(i = 0; i&lt; len+3;i++)<br>  //{<br>  // hex += buf[5+i];<br>  //}<br>  //if(hex != buf[5+i])<br>  // return 0;<br>for(i=0; i&lt;len; i++)<br>  {<pre><code> buf[i]= buf[number+i];</code></pre>
}<br>  buf[i] = ‘\0’;<br>return len;<br>}<br>int unpack_buf3(U8 *buf, int bufsize)<br>{<br>int number = 0;<br>int i;<br>int len;<br>if(bufsize &lt; 7)<br>return 0;<br>len = buf[5]&amp;0x3f;    //去掉最高两位<br>if(len==0)<br>  {<pre><code> len=buf[6];</code></pre>
number=6;<br>}<br>else<br>number=5;<br>if(bufsize &lt; number + len+1)<br>return 0;<br>//校验和校验<br>  //for(i = 0; i&lt; len+1;i++)<br>  //{<br>  // hex += buf[5+i];<br>  //}<br>  //if(hex != buf[5+i])<br>  // return 0;<br>for(i=0; i&lt;len;i++)<br>  {<pre><code> buf[i] = buf[number+i];</code></pre>
}<br>return len;<br>}<br>int unpack_buf2(U8 *buf, int bufsize)<br>{<br>int number=0;<br>int i;<br>U8 len;<br>//U8 hex = 0;<br>if(bufsize &lt; 8)<br>return 0;<br>//长度校验<br>len = buf[5]&amp;0x3f;<br>if(len==0)<br>  {<pre><code> len=buf[8];</code></pre>
number=9;<br>}<br>else<br>number=8;<br>if(bufsize &lt; number+ len+1)<br>return 0;<br>//校验和校验<br>  //for(i = 0; i&lt; len+3;i++)<br>  //{<br>  // hex += buf[5+i];<br>  //}<br>  //if(hex != buf[5+i])<br>  // return 0;<br>for(i=0; i&lt;len; i++)<br>  {<pre><code> buf[i]= buf[number+i];</code></pre>
}<br>  buf[i] = ‘\0’;<br>return len;<br>}<br>int unpack_buf1(U8 *buf, int bufsize)<br>{<br>int number=0;<br>int i;<br>U8 len;<br>if(bufsize &lt; 7)<br>return 0;<br>len = buf[5]&amp;0x3f;    //去掉最高两位<br>if(len==0)<br>  {<pre><code> len=buf[6];</code></pre>
number=6;<br>}<br>else<br>number=5;<br>if(bufsize &lt; number+1 + len)<br>return 0;<br>//校验和校验<br>  //for(i = 0; i&lt; len+1;i++)<br>  //{<br>  // hex += buf[5+i];<br>  //}<br>  //if(hex != buf[5+i])<br>  // return 0;<br>for(i=0; i&lt;len;i++)<br>  {<pre><code> buf[i] = buf[number+i];</code></pre>
}<br>  buf[i] = ‘\0’;<br>return len;<br>}<br>int unpack_buf0(U8 *buf, int bufsize)<br>{<br>int number=0;<br>int i;<br>if(bufsize &lt; 5)<br>return 0;<br>for(i=5; i&lt;bufsize; i++)<br>  {<pre><code> buf[number++] = buf[i];</code></pre>
}<br>  buf[i] = ‘\0’;<br>return number-1;<br>}<br>int unpack_buf13(U8 *buf, int bufsize)<br>{<br>int number=0;<br>int i;<br>if(bufsize &lt; 5)<br>return 0;<br>for(i=5; i&lt;bufsize; i++)<br>  {<pre><code> buf[number++] = buf[i];</code></pre>
}<br>//计算校验位 异或<br>buf[number] = buf[0];<br>for(i=1;i&lt;number;i++)<br>  {<pre><code> buf[number] ^= buf[i];</code></pre>
}<br>if(buf[number] != buf[number-1])<br>  {<br>return 0;<br>}<br>return number-1;<br>}<br>int unpack_buf14(U8 *buf, int bufsize)<br>{<br>int number=0;<br>int i;<br>if(bufsize &lt; 5)<br>return 0;<br>for(i=5; i&lt;bufsize; i++)<br>  {<pre><code> buf[number++] = buf[i];</code></pre>
}<br>//计算校验位 异或<br>buf[number] = buf[0];<br>for(i=1;i&lt;number-2;i++)<br>  {<pre><code> buf[number] ^= buf[i];</code></pre>
}<br>if(buf[number] != buf[number-2])<br>  {<br>return 0;<br>}<br>return number-1;<br>}<br>int unpack_bufc(U8 *buf, int bufsize)<br>{<br>int number=0;<br>int i;<br>if(bufsize &lt; 6)<br>return 0;<br>if(buf[5] == buf[3] - 3)<br>  {<pre><code> number = buf[5];//number为长度</code></pre>
number+=2;<br>memcpy(buf,buf+5,number);<br>//计算校验和<br>buf[number] = 0x00;<br>for(i=0;i&lt;number-1;i++)<pre><code>    buf[number] += buf[i];</code></pre>
if(buf[number] != buf[number-1])<pre><code> &#123;
    memcpy(buf,buf+1,number-2);</code></pre>
return 0;<br>}<br>else<br>{<pre><code>    memcpy(buf,buf+1,number-2);</code></pre>
return number-2;<br>}<br>  }<br>else<br>     return 0;<br>}<br>//暂时以方式2解包<br>int unpack_bufd(U8 *buf, int bufsize)<br>{<br>int number=0;<br>int i;<br>U8 len;<br>//U8 hex = 0;<br>if(bufsize &lt; 8)<br>return 0;<br>//长度校验<br>len = buf[5]&amp;0x3f;<br>if(len==0)<br>  {<pre><code> len=buf[8];</code></pre>
number=9;<br>}<br>else<br>number=8;<br>if(bufsize &lt; number+ len+1)<br>return 0;<br>//校验和校验<br>  //for(i = 0; i&lt; len+3;i++)<br>  //{<br>  // hex += buf[5+i];<br>  //}<br>  //if(hex != buf[5+i])<br>  // return 0;<br>for(i=0; i&lt;len; i++)<br>  {<pre><code> buf[i]= buf[number+i];</code></pre>
}<br>  buf[i] = ‘\0’;<br>return len;<br>}<br>int unpack_buff(U8 *buf, int bufsize)<br>{<br>int number=0;<br>int i;<br>U8 len;<br>if(bufsize &lt; 8)<br>return 0;<br>number=5;<br>//长度校验<br>len = buf[6];<br>//if(bufsize &lt; len+6)<br>  // return 0;<br>  //校验和校验<br>  //for(i = 0; i&lt; len+3;i++)<br>  //{<br>  // hex += buf[5+i];<br>  //}<br>  //if(hex != buf[5+i])<br>  // return 0;<br>for(i=0; i&lt;len; i++)<br>  {<pre><code> buf[i]= buf[number+i];</code></pre>
}<br>  buf[i] = ‘\0’;<br>return len;<br>}<br>//解包只校验了数据长度<br>int unpack_bufe(U8 *buf, int bufsize)<br>{<br>int number=0;<br>int i;<br>int dnumber=0;<br>if(bufsize &lt; 5)<br>return 0;<br>if(buf[07] != bufsize-6)<br>return 0;<br>for(i=5; i&lt;bufsize-3; i++)<br>  {<pre><code> buf[number++] = buf[i];</code></pre>
dnumber += buf[i];<br>}<br>while(i&lt;bufsize)<br>  {<pre><code> buf[number++] = buf[i++];</code></pre>
}<br>if(buf[number-3] == (dnumber&amp;0x00FF) &amp;&amp; buf[number-2] == (dnumber&amp;0xFF00)&gt;&gt;8)<br>return number-1;<br>else<br>     return 0;<br>}<br>int pack_typeb(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 8;<br>char <em>p;<br>int i;<br>char *p0 ;<br>//int l=285;<br>int m,j,k,n,l;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>m = getHexEx(p0,u8buf+number);<br>//头<br>p = (char</em>)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>p=(char*)ezxml_attr(xml,&quot;TGT&quot;);<br>if(p)<pre><code> u8buf[6] = getHex(p);</code></pre>
else<br>u8buf[6] = g_defaultMsgAttr.m_TGT;<br>if(u8buf[6] == 0x6a)<br>  {<pre><code> u8buf[5] = 0x68;</code></pre>
u8buf[6] = 0x6a;<br>p =(char*)ezxml_attr(xml,&quot;SRC&quot;);<br>if(p)<pre><code>    u8buf[7] = getHex(p);</code></pre>
else<br>u8buf[7] = g_defaultMsgAttr.m_SRC;<br>}<br>else<br>     return 0;<br>//u8buf[5] = m*0x10 + 0x34;<br>m+=4;<br>number = m ;<br>number +=5;<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>//CRC校验<br>l=285;<br>if(m==8||m==7||m==12||m==6||m==10||m==9||m==5||m==11)<br>  {  <pre><code> u8buf[number-1]=0x0a;</code></pre>
if(m==7)<pre><code>    u8buf[number-1]=0xf6;</code></pre>
if(m==12)<pre><code>    u8buf[number-1]=0xe2;</code></pre>
if(m==6)<pre><code>    u8buf[number-1]=0x10;</code></pre>
if(m==10)<pre><code>    u8buf[number-1]=0x7c;</code></pre>
if(m==9)<pre><code>    u8buf[number-1]=0xe9;</code></pre>
if(m==11)<pre><code>    u8buf[number-1]=0xfe;</code></pre>
if(m==5)<pre><code>    u8buf[number-1]=0x59;</code></pre>
j=u8buf[5];<br>for(i=6;i&lt;number;i++)<pre><code> &#123;</code></pre>
//MessageBox(&quot;ok&quot;);<br>for(k=0;k&lt;8;k++)<pre><code>    &#123;
       j=j&amp;lt;&amp;lt;1;</code></pre>
n=(u8buf[i]&gt;&gt;(7-k))&amp;0x01;<br>j+=n;<br>if(j&gt;255)<pre><code>          j=j^l;</code></pre>
}<pre><code> &#125;
 u8buf[number-1]=j;</code></pre>
}<br>  u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_typea(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 8;<br>int i;<br>char <em>p;<br>char *p0 ;<br>int l=285;<br>int m,j,k,n;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>m = getHexEx(p0,u8buf+number);<br>//头<br>p = (char</em>)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>p=(char*)ezxml_attr(xml,&quot;TGT&quot;);<br>if(p)<pre><code> u8buf[6] = getHex(p);</code></pre>
else<br>u8buf[6] = g_defaultMsgAttr.m_TGT;<br>p =(char*)ezxml_attr(xml,&quot;SRC&quot;);<br>if(p)<pre><code> u8buf[7] = getHex(p);</code></pre>
else<br>u8buf[7] = g_defaultMsgAttr.m_SRC;<br>getHexEx(p0,u8buf+number);<br>u8buf[5] = 0xc4;<br>number = m ;<br>number += 8;<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>m += 3;    <br>//CRC校验<br>if(m==8||m==7||m==12||m==6||m==10||m==9||m==5||m==11)<br>  {  <pre><code> u8buf[number-1]=0x0a;</code></pre>
if(m==7)<pre><code>    u8buf[number-1]=0xf6;</code></pre>
if(m==12)<pre><code>    u8buf[number-1]=0xe2;</code></pre>
if(m==6)<pre><code>    u8buf[number-1]=0x10;</code></pre>
if(m==10)<pre><code>    u8buf[number-1]=0x7c;</code></pre>
if(m==9)<pre><code>    u8buf[number-1]=0xe9;</code></pre>
if(m==11)<pre><code>    u8buf[number-1]=0xfe;</code></pre>
if(m==5)<pre><code>    u8buf[number-1]=0x59;</code></pre>
j=u8buf[5];<br>for(i=6;i&lt;number;i++)<pre><code> &#123;</code></pre>
//MessageBox(&quot;ok&quot;);<br>for(k=0;k&lt;8;k++)<pre><code>    &#123;
       j=j&amp;lt;&amp;lt;1;</code></pre>
n=(u8buf[i]&gt;&gt;(7-k))&amp;0x01;<br>j+=n;<br>if(j&gt;255)<pre><code>          j=j^l;</code></pre>
}<pre><code> &#125;
 u8buf[number-1]=j;</code></pre>
}<br>  u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type9(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 8;<br>char <em>p;<br>int i;<br>char *p0 ;<br>//int l=285;<br>int m,j,k,n,l;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>m = getHexEx(p0,u8buf+number);<br>//头<br>p = (char</em>)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>p=(char*)ezxml_attr(xml,&quot;TGT&quot;);<br>if(p)<pre><code> u8buf[6] = getHex(p);</code></pre>
else<br>u8buf[6] = g_defaultMsgAttr.m_TGT;<br>if(u8buf[6] == 0x6a)<br>  {<pre><code> u8buf[5] = 0x61;</code></pre>
u8buf[6] = 0x6a;<br>p =(char*)ezxml_attr(xml,&quot;SRC&quot;);<br>if(p)<pre><code>    u8buf[7] = getHex(p);</code></pre>
else<br>u8buf[7] = g_defaultMsgAttr.m_SRC;<br>}<br>else<br>     return 0;<br>//u8buf[5] = m*0x10 + 0x34;<br>m+=4;<br>number = m ;<br>number +=5;<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>//CRC校验<br>l=285;<br>if(m==8||m==7||m==12||m==6||m==10||m==9||m==5||m==11)<br>  {  <pre><code> u8buf[number-1]=0x0a;</code></pre>
if(m==7)<pre><code>    u8buf[number-1]=0xf6;</code></pre>
if(m==12)<pre><code>    u8buf[number-1]=0xe2;</code></pre>
if(m==6)<pre><code>    u8buf[number-1]=0x10;</code></pre>
if(m==10)<pre><code>    u8buf[number-1]=0x7c;</code></pre>
if(m==9)<pre><code>    u8buf[number-1]=0xe9;</code></pre>
if(m==11)<pre><code>    u8buf[number-1]=0xfe;</code></pre>
if(m==5)<pre><code>    u8buf[number-1]=0x59;</code></pre>
j=u8buf[5];<br>for(i=6;i&lt;number;i++)<pre><code> &#123;</code></pre>
//MessageBox(&quot;ok&quot;);<br>for(k=0;k&lt;8;k++)<pre><code>    &#123;
       j=j&amp;lt;&amp;lt;1;</code></pre>
n=(u8buf[i]&gt;&gt;(7-k))&amp;0x01;<br>j+=n;<br>if(j&gt;255)<pre><code>          j=j^l;</code></pre>
}<pre><code> &#125;
 u8buf[number-1]=j;</code></pre>
}<br>  u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type8(ezxml_t xml, U8 <em>u8buf, int bufsize)<br>{<br>int number = 8;<br>int i;<br>char <em>p;<br>char *p0 ;<br>//int l=285;<br>int m;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>m = getHexEx(p0,u8buf+number);<br>u8buf[5] = m</em>0x10 + 0x34;<br>number = m ;<br>number += 9;<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char</em>)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>p=(char*)ezxml_attr(xml,&quot;TGT&quot;);<br>if(p)<pre><code> u8buf[6] = getHex(p);</code></pre>
else<br>u8buf[6] = g_defaultMsgAttr.m_TGT;<br>p =(char*)ezxml_attr(xml,&quot;SRC&quot;);<br>if(p)<pre><code> u8buf[7] = getHex(p);</code></pre>
else<br>u8buf[7] = g_defaultMsgAttr.m_SRC;<br>//校验和<br>u8buf[number-1] = 0;<br>for(i = 5; i&lt;number-1; i++)<br>  {<pre><code> u8buf[number-1] += u8buf[i];</code></pre>
}<br>  u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type7(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char <em>p;<br>char *p0 ;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>number+=getHexEx(p0,u8buf+number);<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char</em>)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>u8buf[number-1]=0;<br>for(i=5;i&lt;number-1;i++)<pre><code> u8buf[number-1]+=u8buf[i];</code></pre>
//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type6(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char <em>p;<br>char *p0 ;<br>int l=285;<br>int m,j,k,n;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>number=getHexEx(p0,u8buf+number);<br>number+=5;<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char</em>)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>m=number-5;<br>//CRC校验<br>if(m==8||m==7||m==12||m==6||m==10||m==9||m==5||m==11)<br>  {  <pre><code> u8buf[number-1]=0x0a;</code></pre>
if(m==7)<pre><code>    u8buf[number-1]=0xf6;</code></pre>
if(m==12)<pre><code>    u8buf[number-1]=0xe2;</code></pre>
if(m==6)<pre><code>    u8buf[number-1]=0x10;</code></pre>
if(m==10)<pre><code>    u8buf[number-1]=0x7c;</code></pre>
if(m==9)<pre><code>    u8buf[number-1]=0xe9;</code></pre>
if(m==11)<pre><code>    u8buf[number-1]=0xfe;</code></pre>
if(m==5)<pre><code>    u8buf[number-1]=0x59;</code></pre>
j=u8buf[5];<br>for(i=6;i&lt;number;i++)<pre><code> &#123;</code></pre>
//MessageBox(&quot;ok&quot;);<br>for(k=0;k&lt;8;k++)<pre><code>    &#123;
       j=j&amp;lt;&amp;lt;1;</code></pre>
n=(u8buf[i]&gt;&gt;(7-k))&amp;0x01;<br>j+=n;<br>if(j&gt;255)<pre><code>          j=j^l;</code></pre>
}<pre><code> &#125;
 u8buf[number-1]=j;</code></pre>
}<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type5(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char *p;<br>char *p0 ;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>u8buf[number++] = 0x68;<br>u8buf[number++] = 0x6a;<br>p = (char *)ezxml_attr(xml,&quot;SRC&quot;);<br>if(p)<pre><code> u8buf[number++] = getHex(p);</code></pre>
else<br>u8buf[number++] = g_defaultMsgAttr.m_SRC;<br>number+=getHexEx(p0,u8buf+number);<br>/<em>u8buf[number++] = getHex(p0);<br>  while(p = (char</em>)strstr(p0,&quot;,&quot;))<br>  {<br>     u8buf[number++] = getHex(p+1);<br>     p0 = p+1;<br>     if(number &gt;= bufsize)<br>        break;<br>  }*/<br>  //校验<br>u8buf[number] = 0;<br>for(i = 5; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  number++;<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type4(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char <em>p;<br>char *p0 ;<br>U8 buf[256];<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>u8buf[number++] = 0x80;<br>p=(char</em>)ezxml_attr(xml,&quot;TGT&quot;);<br>if(p)<pre><code> u8buf[number++] = getHex(p);</code></pre>
else<br>u8buf[number++] = g_defaultMsgAttr.m_TGT;<br>p =(char*)ezxml_attr(xml,&quot;SRC&quot;);<br>if(p)<pre><code> u8buf[number++] = getHex(p);</code></pre>
else<br>u8buf[number++] = g_defaultMsgAttr.m_SRC;<br>u8buf[number++] =getHexEx(ezxml_txt(xml),buf);<br>number+=getHexEx(p0,u8buf+number);<br>/<em>u8buf[number++] = getHex(p0);<br>  while(p = (char</em>)strstr(p0,&quot;,&quot;))<br>  {<br>     u8buf[number++] = getHex(p+1);<br>     p0 = p+1;<br>     if(number &gt;= bufsize)<br>        break;<br>  }<br>  */<br>u8buf[number] = 0;<br>for(i = 5; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  number++;<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type3(ezxml_t xml, U8 <em>u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char *p;<br>char *p0 ;<br>U8  buf[256];<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>u8buf[number++] = 0x80;<br>u8buf[number++] = getHexEx(ezxml_txt(xml),buf);<br>number+=getHexEx(p0,u8buf+number);<br>/*u8buf[number++] = getHex(p0);<br>  while(p = (char</em>)strstr(p0,&quot;,&quot;))<br>  {<br>     u8buf[number++] = getHex(p+1);<br>     p0 = p+1;<br>     if(number &gt;= bufsize)<br>        break;<br>  }<br>  */<br>u8buf[number] = 0;<br>for(i = 5; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  number++;<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type2(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char <em>p;<br>char *p0 ;<br>U8 buf[256];<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>u8buf[number++] = 0x80 + getHexEx(ezxml_txt(xml),buf);<br>p=(char</em>)ezxml_attr(xml,&quot;TGT&quot;);<br>if(p)<pre><code> u8buf[number++] = getHex(p);</code></pre>
else<br>u8buf[number++] = g_defaultMsgAttr.m_TGT;<br>p =(char*)ezxml_attr(xml,&quot;SRC&quot;);<br>if(p)<pre><code> u8buf[number++] = getHex(p);</code></pre>
else<br>u8buf[number++] = g_defaultMsgAttr.m_SRC;<br>number+=getHexEx(p0,u8buf+number);<br>/<em>u8buf[number++] = getHex(p0);<br>  while(p = (char</em>)strstr(p0,&quot;,&quot;))<br>  {<br>     u8buf[number++] = getHex(p+1);<br>     p0 = p+1;<br>     if(number &gt;= bufsize)<br>        break;<br>  }</li>
<li>/<br>  //校验<br>u8buf[number] = 0;<br>for(i = 5; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  number++;<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type1(ezxml_t xml, U8 <em>u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char *p;<br>char *p0 ;<br>U8 buf[256];<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>u8buf[number++] = 0x80 + getHexEx(ezxml_txt(xml),buf);<br>number+=getHexEx(p0,u8buf+number);<br>/*u8buf[number++] = getHex(p0);<br>  while(p = (char</em>)strstr(p0,&quot;,&quot;))<br>  {<br>     u8buf[number++] = getHex(p+1);<br>     p0 = p+1;<br>     if(number &gt;= bufsize)<br>        break;<br>  }<br>  */<br>  //校验<br>u8buf[number] = 0;<br>for(i = 5; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  number++;<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type0(ezxml_t xml, U8 <em>u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char *p;<br>char *p0 ;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>number+=getHexEx(p0,u8buf+number);<br>/*u8buf[number++] = getHex(p0);<br>  while(p = (char</em>)strstr(p0,&quot;,&quot;))<br>  {<br>     if(strlen(p+1)&gt;0)<br>        u8buf[number++] = getHex(p+1);<br>     p0 = p+1;<br>     if(number &gt;= bufsize)<br>        break;<br>  }</li>
<li>/<br>  //头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type13(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char <em>p;<br>char *p0 ;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>number+=getHexEx(p0,u8buf+number);<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char</em>)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>//处理校验位 异或<br>u8buf[number-1] = u8buf[5];<br>for(i=6;i&lt;number-1;i++)<br>  {<pre><code> u8buf[number-1] ^= u8buf[i];</code></pre>
}<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_type14(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 6;<br>int i;<br>char <em>p;<br>char *p0 ;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>number+=getHexEx(p0,u8buf+5);<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char</em>)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>//处理校验位 异或<br>u8buf[number-1] = u8buf[5];<br>for(i=6;i&lt;number-1;i++)<br>  {<pre><code> u8buf[number-1] ^= u8buf[i];</code></pre>
}<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_typec(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 6;<br>int i;<br>char <em>p;<br>char *p0;<br>int len=0;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>len = getHexEx(p0,u8buf+number);<br>number+=len+1;<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char</em>)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>u8buf[5] = len;<br>//校验和<br>u8buf[number-1] = 0;<br>for(i = 5; i&lt;number-1; i++)<br>  {<pre><code> u8buf[number-1] += u8buf[i];</code></pre>
}<br>//一字节取反<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_typed(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char <em>p;<br>char *p0 ;<br>U8 buf[256];<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>u8buf[number++] = 0xC0 + getHexEx(ezxml_txt(xml),buf);<br>p=(char</em>)ezxml_attr(xml,&quot;TGT&quot;);<br>if(p)<pre><code> u8buf[number++] = getHex(p);</code></pre>
else<br>u8buf[number++] = g_defaultMsgAttr.m_TGT;<br>p =(char*)ezxml_attr(xml,&quot;SRC&quot;);<br>if(p)<pre><code> u8buf[number++] = getHex(p);</code></pre>
else<br>u8buf[number++] = g_defaultMsgAttr.m_SRC;<br>number+=getHexEx(p0,u8buf+number);<br>u8buf[number] = 0;<br>for(i = 5; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  number++;<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_typef(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char *p;<br>char *p0 ;<br>//检查<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>//处理<br>number += getHexEx(p0,u8buf+number);<br>if(u8buf[6]+5==number)<pre><code> number=number-1;</code></pre>
//校验<br>u8buf[number] = 0;<br>for(i = 5; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number]=~u8buf[number]+1;<br>number++;<br>//头<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int pack_typee(ezxml_t xml, U8 *u8buf, int bufsize)<br>{<br>int number = 5;<br>int i;<br>char *p;<br>char *p0 ;<br>U8 buf[256];<br>U8 len;<br>int dnumber=0;<br>if(xml == NULL)<br>return 0;<br>p0 = (char *)ezxml_txt(xml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>len = getHexEx(ezxml_txt(xml),buf);<br>if(buf[02]==len)<br>  {<br>//计算校验和<br>for(i=0;i&lt;len-2;i++)<pre><code> &#123;
    dnumber += buf[i];</code></pre>
}<pre><code> buf[len-2] = dnumber&amp;amp;0x00FF;</code></pre>
buf[len-1] = (dnumber&amp;0xFF00)&gt;&gt;8;<br>for(i=0;i&lt;len;i++)<pre><code> &#123;
    u8buf[number++] = buf[i];</code></pre>
}<br>  }<br>else<br>     return 0;<br>u8buf[0] = 0xa5;<br>u8buf[1] = 0xa5;<br>u8buf[2] = (number-4) / 0x100;<br>u8buf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(xml,&quot;ORD&quot;);<br>if(p)<pre><code> u8buf[4] = getHex(p);</code></pre>
else<br>u8buf[4] = g_defaultMsgAttr.m_ORD;<br>//校验和<br>u8buf[number] = 0;<br>for(i = 2; i&lt;number; i++)<br>  {<pre><code> u8buf[number] += u8buf[i];</code></pre>
}<br>  u8buf[number] = ~u8buf[number];    <br>return number+1;<br>}<br>int crcVerify(U8 *buf, int len)<br>{<br>int i;<br>int j;<br>int l;<br>int k;<br>int n;<br>if(len==9||len==8||len==13||len==7||len==11||len==10||len==6||len==12)<br>  {  <pre><code> buf[len-1]=0x0a;</code></pre>
if(len==8)<pre><code>    buf[len-1]=0xf6;</code></pre>
if(len==13)<pre><code>    buf[len-1]=0xe2;</code></pre>
if(len==7)<pre><code>    buf[len-1]=0x10;</code></pre>
if(len==11)<pre><code>    buf[len-1]=0x7c;</code></pre>
if(len==10)<pre><code>    buf[len-1]=0xe9;</code></pre>
if(len==12)<pre><code>    buf[len-1]=0xfe;</code></pre>
if(len==6)<pre><code>    buf[len-1]=0x59;</code></pre>
l=285;<br>j=buf[1];<br>for(i=2;i&lt;len;i++)<pre><code> &#123;</code></pre>
//lenessageBox(&quot;ok&quot;);<br>for(k=0;k&lt;8;k++)<pre><code>    &#123;
       j=j&amp;lt;&amp;lt;1;</code></pre>
n=(buf[i]&gt;&gt;(7-k))&amp;0x01;<br>j+=n;<br>if(j&gt;255)<pre><code>          j=j^l;</code></pre>
}<pre><code> &#125;
 buf[len-1]=j;</code></pre>
}<br>else<br>     return 0;<br>return 1;<br>}<br>int autoFillCrc(char* strHex)<br>{<br>size_t i;<br>U8 buf[256];<br>int buflen = 0;<br>for(i=0; i&lt;strlen(strHex); i+=3)<br>  {<pre><code> buf[buflen++] =getHex(strHex+i); </code></pre>
if(buflen &gt; 255)<br>return 0;<br>}<br>if(!crcVerify(buf, buflen))<br>return 0;<br>sprintf(strHex+3*(buflen-1),&quot;%02x&quot;,buf[buflen-1]);<br>return 1;<br>}<br>int kwptype(ezxml_t msgxml,U8 *recvbuf)<br>{<br>int number;<br>int pack_t;<br>int i;<br>//int dpos = 0;<br>U8 nTempData=0;<br>if(msgxml != NULL)<br>  {<pre><code> pack_t = getPackType(msgxml);</code></pre>
number = pack_type(msgxml, recvbuf , 256);<br>Uart_ClearInput(g_carportHandle);<br>Uart_ClearOutput(g_carportHandle);      <br>Device_SendBuf(g_carportHandle, recvbuf , number);<br>}<br>else<br>{<pre><code> pack_t = 0;</code></pre>
}<br>if((recvbuf[4]&amp;0xf0)==0x20)<br>  {<pre><code> number = Device_ReadBuf(g_carportHandle, recvbuf, 256, 5000);                                              </code></pre>
}<br>else<br>{<pre><code> number = Device_ReadBuf(g_carportHandle, recvbuf, 256, g_defaultMsgAttr.m_AnswerFrameTimeOut*50);                                              </code></pre>
}<br>if(!number)<br>return 0;<br>for(i=5;i&lt;number-2;i++)<br>  {<pre><code> nTempData +=recvbuf[i];</code></pre>
}<br>if(nTempData != recvbuf[i])<br>return 0;<br>if((ezxml_attr(msgxml, &quot;DPOS&quot;))&amp;&amp;(getHex(ezxml_attr(msgxml, &quot;DPOS&quot;))&gt;0))<br>  {<br>//dpos计算数据流的逆向偏移位,此处不能为负值<br>     /<em>dpos = getHex(ezxml_attr(msgxml, &quot;DPOS&quot;));<br>     if(0&lt;dpos&lt;9)<br>     {<br>     Debug_vc(&quot;DPOS=%02X\r\n&quot;,dpos);<br>     memcpy(recvbuf+dpos,recvbuf, number);<br>     }</em>/<br>number = unpack_buf(0, recvbuf, number);<br>}<br>else<br>{<pre><code> number = unpack_buf(pack_t, recvbuf, number);</code></pre>
}<br>return number;<br>}<br>//有长度控制的命令,如02 07 09, 其中02为长度,09为02+07<br>int lentype1(ezxml_t msgxml,U8 <em>recvbuf)<br>{<br>int number;<br>int snumber;<br>int i;<br>int j,k=0;<br>char *p;<br>char *p0 ;<br>U8 sbuf[50];<br>U8 rbuf[50];<br>U8 buf[256];<br>U8 uTempBuf=0;<br>memset(sbuf,0,sizeof(sbuf));<br>snumber=getHexEx(ezxml_txt(msgxml),buf);<br>if(msgxml == NULL)<br>return 0;<br>p0 = (char</em>)ezxml_txt(msgxml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>number = snumber+5;<br>//头<br>sbuf[0] = 0xa5;<br>sbuf[1] = 0xa5;<br>sbuf[2] = (number-4) / 0x100;<br>sbuf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(msgxml,&quot;ORD&quot;);<br>if(p)<pre><code> sbuf[4] = getHex(p);</code></pre>
for(i=0; i &lt; snumber; i++)<br>  {<pre><code> sbuf[i+5]=buf[i];</code></pre>
}<br>  sbuf[number]=0;<br>for(j=2;j&lt;number;j++)<pre><code> sbuf[number]+=sbuf[j];</code></pre>
sbuf[number] = ~sbuf[number];  <br>Uart_ClearInput(g_carportHandle);<br>Uart_ClearOutput(g_carportHandle);<br>Device_SendBuf(g_carportHandle,sbuf ,number+1);<br>if((sbuf[4]&amp;0xf0)==0x20)<br>  {<pre><code> number = Device_ReadBuf(g_carportHandle, rbuf, 256, 5000);                                              </code></pre>
}<br>else<br>{<pre><code> number = Device_ReadBuf(g_carportHandle, rbuf, 256, g_defaultMsgAttr.m_AnswerFrameTimeOut*50);                                              </code></pre>
}<br>if(!number)<br>return 0;<br>if((rbuf[0] != 0xa5) &amp;&amp; (rbuf[1] != 0xa5))<br>return 0;<br>if(number &lt; 5)<br>return 0;<br>if(rbuf[3] == number -5)<br>  {<br>if(rbuf[5] == number-7)<pre><code> &#123;</code></pre>
for(i=0; i&lt;rbuf[5]; ++i)<pre><code>    &#123;
       uTempBuf += rbuf[i+5]; </code></pre>
}<br>if(uTempBuf != rbuf[i+5])<br>return 0;<br>for(j=5;j&lt;number-1;j++)<pre><code>    &#123;  
       recvbuf[k]=rbuf[j];</code></pre>
k++;<br>}<pre><code>    recvbuf[k]=&#39;\0&#39;;</code></pre>
return k;<br>}<br>else<br>        return 0;<br>}<br>else<br>     return 0;<br>}<br>//有长度控制的命令,如韩国大宇f4,56,01,b5格式命令,第二位表示长度,长度为56-52. b5为取补.<br>int lentype2(ezxml_t msgxml,U8 <em>recvbuf)<br>{<br>int number;<br>int snumber;<br>int i;<br>int j,k=0;<br>char *p;<br>char *p0 ;<br>U8 sbuf[250];<br>U8 rbuf[250];<br>U8 buf[256];<br>U8 uTempBuf=0;<br>memset(sbuf,0,sizeof(sbuf));<br>snumber=getHexEx(ezxml_txt(msgxml),buf);<br>if(msgxml == NULL)<br>return 0;<br>p0 = (char</em>)ezxml_txt(msgxml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>number = snumber+5;<br>//头<br>sbuf[0] = 0xa5;<br>sbuf[1] = 0xa5;<br>sbuf[2] = (number-4) / 0x100;<br>sbuf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(msgxml,&quot;ORD&quot;);<br>if(p)<pre><code> sbuf[4] = getHex(p);</code></pre>
for(i=0; i &lt; snumber; i++)<br>  {<pre><code> sbuf[i+5]=buf[i];</code></pre>
}<br>  sbuf[number]=0;<br>for(j=2;j&lt;number;j++)<pre><code> sbuf[number]+=sbuf[j];</code></pre>
sbuf[number] = ~sbuf[number];  <br>Uart_ClearInput(g_carportHandle);<br>Uart_ClearOutput(g_carportHandle);<br>Device_SendBuf(g_carportHandle,sbuf ,number+1);<br>if((sbuf[4]&amp;0xf0)==0x20)<br>  {<pre><code> number = Device_ReadBuf(g_carportHandle, rbuf, 256, 5000);                                              </code></pre>
}<br>else<br>{<pre><code> number = Device_ReadBuf(g_carportHandle, rbuf, 256, g_defaultMsgAttr.m_AnswerFrameTimeOut*50);                                              </code></pre>
}<br>if(!number)<br>return 0;<br>if((rbuf[0] != 0xa5) &amp;&amp; (rbuf[1] != 0xa5))<br>return 0;<br>if(number &lt; 5)<br>return 0;<br>if(rbuf[6] == number+0x52-6)<br>  {<br>for(i=0; i&lt;number-7; ++i)<pre><code> &#123;
    uTempBuf += rbuf[i+5]; </code></pre>
}<pre><code> uTempBuf = ~uTempBuf +1;</code></pre>
if(uTempBuf != rbuf[i+5])<br>return 0;<br>for(j=5;j&lt;number-1;j++)<pre><code> &#123;  
    recvbuf[k]=rbuf[j];</code></pre>
k++;<br>}<pre><code> recvbuf[k]=&#39;\0&#39;;</code></pre>
return k;<br>}<br>else<br>     return 0;<br>}<br>//有长度控制的命令,如01 82 83, 其中01为长度,83为01+82<br>int lentype3(ezxml_t msgxml,U8 <em>recvbuf)<br>{<br>int number;<br>int snumber;<br>int i;<br>int j,k=0;<br>char *p;<br>char *p0 ;<br>U8 sbuf[50];<br>U8 rbuf[50];<br>U8 buf[256];<br>U8 uTempBuf=0;<br>memset(sbuf,0,sizeof(sbuf));<br>snumber=getHexEx(ezxml_txt(msgxml),buf);<br>if(msgxml == NULL)<br>return 0;<br>p0 = (char</em>)ezxml_txt(msgxml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>number = snumber+5;<br>//头<br>sbuf[0] = 0xa5;<br>sbuf[1] = 0xa5;<br>sbuf[2] = (number-4) / 0x100;<br>sbuf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(msgxml,&quot;ORD&quot;);<br>if(p)<pre><code>    sbuf[4] = getHex(p);</code></pre>
for(i=0; i &lt; snumber; i++)<br>  {<pre><code> sbuf[i+5]=buf[i];</code></pre>
}<br>  sbuf[number]=0;<br>for(j=2;j&lt;number;j++)<pre><code> sbuf[number]+=sbuf[j];</code></pre>
sbuf[number] = ~sbuf[number];  <br>Uart_ClearInput(g_carportHandle);<br>Uart_ClearOutput(g_carportHandle);<br>Device_SendBuf(g_carportHandle,sbuf ,number+1);<br>if((sbuf[4]&amp;0xf0)==0x20)<br>  {<pre><code> number = Device_ReadBuf(g_carportHandle, rbuf, 256, 5000);                                              </code></pre>
}<br>else<br>{<pre><code> number = Device_ReadBuf(g_carportHandle, rbuf, 256, g_defaultMsgAttr.m_AnswerFrameTimeOut*50);                                              </code></pre>
}<br>if(!number)<br>return 0;<br>if((rbuf[0] != 0xa5) &amp;&amp; (rbuf[1] != 0xa5))<br>return 0;<br>if(number &lt; 5)<br>return 0;<br>if(rbuf[3] == number -5)<br>  {<br>if(rbuf[5] == number-8)<pre><code> &#123;</code></pre>
for(i=0; i&lt;rbuf[5]+1; ++i)<pre><code>    &#123;
       uTempBuf += rbuf[i+5]; </code></pre>
}<br>if(uTempBuf != rbuf[i+5])<br>return 0;<br>for(j=5;j&lt;number-1;j++)<pre><code>    &#123;  
       recvbuf[k]=rbuf[j];</code></pre>
k++;<br>}<pre><code>    recvbuf[k]=&#39;\0&#39;;</code></pre>
return k;<br>}<br>else<br>        return 0;<br>}<br>else<br>     return 0;<br>}<br>//有长度控制的命令,如03 13 16, 其中03为长度,16为03+13<br>int lentype4(ezxml_t msgxml,U8 <em>recvbuf)<br>{<br>int number;<br>int snumber;<br>int i;<br>int j,k=0;<br>char *p;<br>char *p0 ;<br>U8 sbuf[50];<br>U8 rbuf[50];<br>U8 buf[256];<br>U8 uTempBuf=0;<br>memset(sbuf,0,sizeof(sbuf));<br>snumber=getHexEx(ezxml_txt(msgxml),buf);<br>if(msgxml == NULL)<br>return 0;<br>p0 = (char</em>)ezxml_txt(msgxml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>number = snumber+5;<br>//头<br>sbuf[0] = 0xa5;<br>sbuf[1] = 0xa5;<br>sbuf[2] = (number-4) / 0x100;<br>sbuf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(msgxml,&quot;ORD&quot;);<br>if(p)<pre><code>    sbuf[4] = getHex(p);</code></pre>
for(i=0; i &lt; snumber; i++)<pre><code> &#123;
    sbuf[i+5]=buf[i];</code></pre>
}<pre><code> sbuf[number]=0;</code></pre>
for(j=2;j&lt;number;j++)<pre><code>    sbuf[number]+=sbuf[j];</code></pre>
sbuf[number] = ~sbuf[number];  <br>Uart_ClearInput(g_carportHandle);<br>Uart_ClearOutput(g_carportHandle);<br>Device_SendBuf(g_carportHandle,sbuf ,number+1);<br>if((sbuf[4]&amp;0xf0)==0x20)<pre><code> &#123;
    number = Device_ReadBuf(g_carportHandle, rbuf, 256, 5000);                                              </code></pre>
}<br>else<br>{<pre><code>    number = Device_ReadBuf(g_carportHandle, rbuf, 256, g_defaultMsgAttr.m_AnswerFrameTimeOut*50);                                              </code></pre>
}<br>if(!number)<br>return 0;<br>if((rbuf[0] != 0xa5) &amp;&amp; (rbuf[1] != 0xa5))<br>return 0;<br>if(number &lt; 5)<br>return 0;<br>if(rbuf[3] == number-5)  // &gt;FF情况下不行<br>{<br>if(rbuf[5] == number-6)<pre><code>    &#123;</code></pre>
for(i=0; i&lt;rbuf[5]-1; ++i)<pre><code>       &#123;
          uTempBuf += rbuf[i+5]; </code></pre>
}<br>if(uTempBuf != rbuf[i+5])<br>return 0;<br>for(j=5;j&lt;number-1;j++)<pre><code>       &#123;  
          recvbuf[k]=rbuf[j];</code></pre>
k++;<br>}<pre><code>       recvbuf[k]=&#39;\0&#39;;</code></pre>
return k;<br>}<br>else<br>           return 0;<br>}<br>else<br>        return 0;<br>}<br>//有长度控制的命令,如01 13 14, 其中01为长度,14为13+01<br>int lentype5(ezxml_t msgxml,U8 <em>recvbuf)<br>{<br>int number;<br>int snumber;<br>int i;<br>int j,k=0;<br>char *p;<br>char *p0 ;<br>U8 sbuf[50];<br>U8 rbuf[50];<br>U8 buf[256];<br>U8 uTempBuf=0;<br>memset(sbuf,0,sizeof(sbuf));<br>snumber=getHexEx(ezxml_txt(msgxml),buf);<br>if(msgxml == NULL)<br>return 0;<br>p0 = (char</em>)ezxml_txt(msgxml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>number = snumber+5;<br>//头<br>sbuf[0] = 0xa5;<br>sbuf[1] = 0xa5;<br>sbuf[2] = (number-4) / 0x100;<br>sbuf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(msgxml,&quot;ORD&quot;);<br>if(p)<pre><code>    sbuf[4] = getHex(p);</code></pre>
for(i=0; i &lt; snumber; i++)<pre><code> &#123;
    sbuf[i+5]=buf[i];</code></pre>
}<pre><code> sbuf[number]=0;</code></pre>
for(j=2;j&lt;number;j++)<pre><code>    sbuf[number]+=sbuf[j];</code></pre>
sbuf[number] = ~sbuf[number];  <br>Uart_ClearInput(g_carportHandle);<br>Uart_ClearOutput(g_carportHandle);<br>Device_SendBuf(g_carportHandle,sbuf ,number+1);<br>if((sbuf[4]&amp;0xf0)==0x20)<pre><code> &#123;
    number = Device_ReadBuf(g_carportHandle, rbuf, 256, 5000);                                              </code></pre>
}<br>else<br>{<pre><code>    number = Device_ReadBuf(g_carportHandle, rbuf, 256, g_defaultMsgAttr.m_AnswerFrameTimeOut*50);                                              </code></pre>
}<br>if(!number)<br>return 0;<br>if((rbuf[0] != 0xa5) &amp;&amp; (rbuf[1] != 0xa5))<br>return 0;<br>if(number &lt; 5)<br>return 0;<br>if(rbuf[3] == number -5)             //  &gt;FF情况下不行<br>{<br>if(rbuf[5] == number-8)<pre><code>    &#123;</code></pre>
for(i=0; i&lt;rbuf[5]+1; ++i)<pre><code>       &#123;
          uTempBuf += rbuf[i+5]; </code></pre>
}<br>if(uTempBuf != rbuf[i+5])<br>return 0;<br>for(j=5;j&lt;number-1;j++)<pre><code>       &#123;  
          recvbuf[k]=rbuf[j];</code></pre>
k++;<br>}<pre><code>       recvbuf[k]=&#39;\0&#39;;</code></pre>
return k;<br>}<br>else<br>           return 0;<br>}<br>else<br>        return 0;<br>}<br>//有长度控制的命令,如03 13 ea, 其中03为长度,ea为前面取补<br>int lentype6(ezxml_t msgxml,U8 <em>recvbuf)<br>{<br>int number;<br>int snumber;<br>int i;<br>int j,k=0;<br>char *p;<br>char *p0 ;<br>U8 sbuf[50];<br>U8 rbuf[50];<br>U8 buf[256];<br>U8 uTempBuf=0;<br>memset(sbuf,0,sizeof(sbuf));<br>snumber=getHexEx(ezxml_txt(msgxml),buf);<br>if(msgxml == NULL)<br>return 0;<br>p0 = (char</em>)ezxml_txt(msgxml);<br>if(strlen(p0) &lt; 2)<br>return 0;<br>number = snumber+5;<br>//头<br>sbuf[0] = 0xa5;<br>sbuf[1] = 0xa5;<br>sbuf[2] = (number-4) / 0x100;<br>sbuf[3] = (number-4) % 0x100;<br>p = (char*)ezxml_attr(msgxml,&quot;ORD&quot;);<br>if(p)<pre><code>    sbuf[4] = getHex(p);</code></pre>
for(i=0; i &lt; snumber; i++)<pre><code> &#123;
    sbuf[i+5]=buf[i];</code></pre>
}<pre><code> sbuf[number]=0;</code></pre>
for(j=2;j&lt;number;j++)<pre><code>    sbuf[number]+=sbuf[j];</code></pre>
sbuf[number] = ~sbuf[number];  <br>Uart_ClearInput(g_carportHandle);<br>Uart_ClearOutput(g_carportHandle);<br>Device_SendBuf(g_carportHandle,sbuf ,number+1);<br>if((sbuf[4]&amp;0xf0)==0x20)<pre><code> &#123;
    number = Device_ReadBuf(g_carportHandle, rbuf, 256, 5000);                                              </code></pre>
}<br>else<br>{<pre><code>    number = Device_ReadBuf(g_carportHandle, rbuf, 256, g_defaultMsgAttr.m_AnswerFrameTimeOut*50);                                              </code></pre>
}<br>if(!number)<br>return 0;<br>if((rbuf[0] != 0xa5) &amp;&amp; (rbuf[1] != 0xa5))<br>return 0;<br>if(number &lt; 5)<br>return 0;<br>if(rbuf[3] == number-5)  // &gt;FF情况下不行<br>{<br>if(rbuf[5] == number-6)<pre><code>    &#123;</code></pre>
for(i=0; i&lt;rbuf[5]-1; ++i)<pre><code>       &#123;
          uTempBuf += rbuf[i+5]; </code></pre>
}<pre><code>       uTempBuf = (~uTempBuf)+1;</code></pre>
if(uTempBuf != rbuf[i+5])<br>return 0;<br>for(j=5;j&lt;number-1;j++)<pre><code>       &#123;  
          recvbuf[k]=rbuf[j];</code></pre>
k++;<br>}<pre><code>       recvbuf[k]=&#39;\0&#39;;</code></pre>
return k;<br>}<br>else<br>           return 0;<br>}<br>else<br>        return 0;<br>}<br>#ifdef __cplusplus<br>}<br>#endif </li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://edward.org.cn/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/ota%E5%8D%87%E7%BA%A7%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Edward">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="点点滴滴">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/ota%E5%8D%87%E7%BA%A7%E5%8C%85/" class="post-title-link" itemprop="url">ota升级包</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-31 14:48:01" itemprop="dateCreated datePublished" datetime="2020-12-31T14:48:01+08:00">2020-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-16 12:37:33" itemprop="dateModified" datetime="2020-01-16T12:37:33+08:00">2020-01-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%83%82%E7%AC%94%E5%A4%B4/" itemprop="url" rel="index"><span itemprop="name">烂笔头</span></a>
                </span>
            </span>

          
            <span id="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/ota%E5%8D%87%E7%BA%A7%E5%8C%85/" class="post-meta-item leancloud_visitors" data-flag-title="ota升级包" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>./mkimage.sh ota</p>
<p>生成ota完整包</p>
<p>make otapackage</p>
<p>生成差异包</p>
<p>./build/tools/releasetools/ota_from_target_files -v -i out/target/product/rk2928sdk/obj/PACKAGING/target_files_intermediates/rk2928sdk-target_files-20130123.175438.zip -p out/host/linux-x86/ -k build/target/product/security/testkey out/target/product/rk2928sdk/obj/PACKAGING/target_files_intermediates/rk2928sdk-target_files-20130123.190455.zip out/target/product/rk2928sdk/update.zip</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://edward.org.cn/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/OSI%E4%B8%83%E5%B1%82%E5%8D%8F%E8%AE%AE%E6%A8%A1%E5%9E%8B%E3%80%81TCPIP%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Edward">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="点点滴滴">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/OSI%E4%B8%83%E5%B1%82%E5%8D%8F%E8%AE%AE%E6%A8%A1%E5%9E%8B%E3%80%81TCPIP%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">OSI七层协议模型、TCPIP四层模型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-31 14:48:01" itemprop="dateCreated datePublished" datetime="2020-12-31T14:48:01+08:00">2020-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-16 12:37:31" itemprop="dateModified" datetime="2020-01-16T12:37:31+08:00">2020-01-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%83%82%E7%AC%94%E5%A4%B4/" itemprop="url" rel="index"><span itemprop="name">烂笔头</span></a>
                </span>
            </span>

          
            <span id="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/OSI%E4%B8%83%E5%B1%82%E5%8D%8F%E8%AE%AE%E6%A8%A1%E5%9E%8B%E3%80%81TCPIP%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B/" class="post-meta-item leancloud_visitors" data-flag-title="OSI七层协议模型、TCPIP四层模型" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li>OSI七层和TCP/IP四层的关系</li>
</ol>
<p>1.1 OSI引入了服务、接口、协议、分层的概念，TCP/IP借鉴了OSI的这些概念建立TCP/IP模型。</p>
<p>1.2 OSI先有模型，后有协议，先有标准，后进行实践；而TCP/IP则相反，先有协议和应用再提出了模型，且是参照的OSI模型。</p>
<p>1.3 OSI是一种理论下的模型，而TCP/IP已被广泛使用，成为网络互联事实上的标准。</p>
<p>TCP：transmission control protocol 传输控制协议</p>
<p>UDP：user data protocol 用户数据报协议</p>
<p>OSI七层网络模型</p>
<p>TCP/IP四层概念模型  </p>
<p>对应网络协议</p>
<p>应用层（Application）</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/OSI%E4%B8%83%E5%B1%82%E5%8D%8F%E8%AE%AE%E6%A8%A1%E5%9E%8B%E3%80%81TCPIP%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://edward.org.cn/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/oracle-java6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Edward">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="点点滴滴">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/oracle-java6/" class="post-title-link" itemprop="url">oracle-java6</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-31 14:48:01" itemprop="dateCreated datePublished" datetime="2020-12-31T14:48:01+08:00">2020-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-16 12:37:32" itemprop="dateModified" datetime="2020-01-16T12:37:32+08:00">2020-01-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%83%82%E7%AC%94%E5%A4%B4/" itemprop="url" rel="index"><span itemprop="name">烂笔头</span></a>
                </span>
            </span>

          
            <span id="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/oracle-java6/" class="post-meta-item leancloud_visitors" data-flag-title="oracle-java6" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>It is recommended to build Android using the Oracle JDK 6. However it is no longer available as package in Ubuntu. A good source is <a target="_blank" rel="noopener" href="http://www.webupd8.org/">http://www.webupd8.org</a></p>
<p>sudo add-apt-repository ppa:webupd8team/java</p>
<p>sudo apt-get update</p>
<p>sudo apt-get install oracle-java6-installer</p>
<p>sudo update-java-alternatives -s java-6-oracle</p>
<p>sudo apt-get install oracle-java6-set-default</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://edward.org.cn/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/OneDrive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Edward">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="点点滴滴">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/OneDrive/" class="post-title-link" itemprop="url">OneDrive</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-31 14:48:01" itemprop="dateCreated datePublished" datetime="2020-12-31T14:48:01+08:00">2020-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-16 12:37:34" itemprop="dateModified" datetime="2020-01-16T12:37:34+08:00">2020-01-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%83%82%E7%AC%94%E5%A4%B4/" itemprop="url" rel="index"><span itemprop="name">烂笔头</span></a>
                </span>
            </span>

          
            <span id="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/OneDrive/" class="post-meta-item leancloud_visitors" data-flag-title="OneDrive" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://t.odmail.cn/">https://t.odmail.cn</a> 注册临时邮箱</p>
<p><a href="mailto:&#109;&#97;&#103;&#x69;&#x63;&#x65;&#x64;&#119;&#x61;&#114;&#100;&#x40;&#116;&#46;&#x6f;&#100;&#109;&#97;&#x69;&#108;&#46;&#99;&#110;">&#109;&#97;&#103;&#x69;&#x63;&#x65;&#x64;&#119;&#x61;&#114;&#100;&#x40;&#116;&#46;&#x6f;&#100;&#109;&#97;&#x69;&#108;&#46;&#99;&#110;</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://edward.org.cn/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/odex%20%E5%8F%8D%E7%BC%96%E8%AF%91%E5%8F%8A%E7%AD%BE%E5%90%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Edward">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="点点滴滴">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/odex%20%E5%8F%8D%E7%BC%96%E8%AF%91%E5%8F%8A%E7%AD%BE%E5%90%8D/" class="post-title-link" itemprop="url">odex 反编译及签名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-31 14:48:01" itemprop="dateCreated datePublished" datetime="2020-12-31T14:48:01+08:00">2020-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-16 12:37:33" itemprop="dateModified" datetime="2020-01-16T12:37:33+08:00">2020-01-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%83%82%E7%AC%94%E5%A4%B4/" itemprop="url" rel="index"><span itemprop="name">烂笔头</span></a>
                </span>
            </span>

          
            <span id="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/odex%20%E5%8F%8D%E7%BC%96%E8%AF%91%E5%8F%8A%E7%AD%BE%E5%90%8D/" class="post-meta-item leancloud_visitors" data-flag-title="odex 反编译及签名" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>java -jar baksmali-2.2.1.jar x android.policy.odex -d classpath</p>
<p>java -jar smali-2.1.2.jar out -o pclasses.dex</p>
<hr>
<p>直接用apktool 比较省事 </p>
<p>$ apktool d testapp.apk</p>
<p>$ apktool b bar</p>
<p>adb push ./dexopt-wrapper /system/bin <br>chmod 777 /system/bin/dexopt-wrapper</p>
<p>重新生成odex</p>
<p>dexopt-wrapper /system/framework/android.policy.jar /system/framework/new_android.policy.odex $BOOTCLASSPATH</p>
<p>odex拷贝原来的签名信息</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/12/31/%E7%83%82%E7%AC%94%E5%A4%B4/odex%20%E5%8F%8D%E7%BC%96%E8%AF%91%E5%8F%8A%E7%AD%BE%E5%90%8D/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/29/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><span class="page-number current">30</span><a class="page-number" href="/page/31/">31</a><span class="space">&hellip;</span><a class="page-number" href="/page/56/">56</a><a class="extend next" rel="next" href="/page/31/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Edward"
      src="/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">Edward</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">554</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Edward</span>
</div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"wxYx0BX9gaKA3XC4LuO2of0v-gzGzoHsz","app_key":"LQMcs6IDIE4YAm10vMsn9IYq","server_url":"https://wxyx0bx9.lc-cn-n1-shared.com","security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
